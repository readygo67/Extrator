package runner

import (
	"context"
	"encoding/hex"
	"fmt"
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/ethclient"
	"github.com/stretchr/testify/require"
	"github.com/syndtr/goleveldb/leveldb/util"
	"math/big"
	"strings"
	"testing"
)

func TestGetPancakeAllPairsLength(t *testing.T) {
	rpcURL := "https://bsc-dataseed.binance.org"
	c, err := ethclient.Dial(rpcURL)
	require.NoError(t, err)

	pancakeFactory, err := NewPancakeFactory(common.HexToAddress("0xcA143Ce32Fe78f1f7019d7d551a6402fC5350c73"), c)
	allLength, err := pancakeFactory.AllPairsLength(nil)
	fmt.Printf("all length:%v", allLength)
}

func TestGetPancakePairInfo(t *testing.T) {
	rpcURL := "https://bsc-dataseed.binance.org"
	c, err := ethclient.Dial(rpcURL)
	require.NoError(t, err)
	factoryAddr := common.HexToAddress("0xcA143Ce32Fe78f1f7019d7d551a6402fC5350c73")

	factory, err := NewPancakeFactory(factoryAddr, c)
	allLength, err := factory.AllPairsLength(nil)
	fmt.Printf("all length:%v\n", allLength)

	pairAddr, err := factory.AllPairs(nil, big.NewInt(0))

	pair, err := NewPancakePair(pairAddr, c)
	require.NoError(t, err)
	fmt.Printf("pair addr:%v\n", pairAddr)
	token0Addr, err := pair.Token0(nil)
	require.NoError(t, err)
	token1Addr, err := pair.Token1(nil)
	require.NoError(t, err)

	token0, _ := NewBep20(token0Addr, c)
	token1, _ := NewBep20(token1Addr, c)

	symbol0, _ := token0.Symbol(nil)
	symbol1, _ := token1.Symbol(nil)

	fmt.Printf("symbol0:%v, symbol1:%v\n", symbol0, symbol1)

	addrs := []common.Address{}
	addrs = append(addrs, token0Addr, token1Addr)
	fmt.Printf("addrs:%v\n", addrs)
}

func TestCheckSafeMoon(t *testing.T) {
	rpcURL := "https://bsc-dataseed.binance.org"
	c, err := ethclient.Dial(rpcURL)
	require.NoError(t, err)

	byteCode, _ := c.CodeAt(context.Background(), common.HexToAddress("0xe98ac4c09a3fcc35be438681652602454f6745b7"), nil)
	code := hex.EncodeToString(byteCode)

	require.True(t, main.isSafeMoon(code))
	require.False(t, main.isVictim(code))

}

func TestSearchSafeMoon(t *testing.T) {
	tokenMap := make(map[common.Address]bool)
	tokenCount := int(0)
	safeMoonList := []common.Address{}
	victimList := []common.Address{}

	db, err := NewDB("testdb")
	if err != nil {
		panic(err)
	}
	defer db.Close()

	storedIndex := int64(0)
	startIndex := int64(0)

	exist, err := db.Has(LastHandledIndexStoreKey(), nil)
	if exist {
		bz, err := db.Get(LastHandledIndexStoreKey(), nil)
		if err != nil {
			panic(err)
		}
		storedIndex = big.NewInt(0).SetBytes(bz).Int64()
		startIndex = storedIndex + 1
	}

	iter := db.NewIterator(util.BytesPrefix(TokenPrefix), nil)
	defer iter.Release()
	for iter.Next() {
		addr := common.BytesToAddress(iter.Value())
		tokenMap[addr] = true
		tokenCount++
	}

	iter = db.NewIterator(util.BytesPrefix(SafeMoonPrefix), nil)
	for iter.Next() {
		addr := common.BytesToAddress(iter.Value())
		safeMoonList = append(safeMoonList, addr)
	}

	iter = db.NewIterator(util.BytesPrefix(VictimPrefix), nil)
	for iter.Next() {
		addr := common.BytesToAddress(iter.Value())
		victimList = append(victimList, addr)
	}

	fmt.Printf("intial, startIndex:%v, tokenCount:%v\n", startIndex, tokenCount)

	rpcURL := "https://bsc-dataseed.binance.org"
	c, err := ethclient.Dial(rpcURL)
	require.NoError(t, err)
	factoryAddr := common.HexToAddress("0xcA143Ce32Fe78f1f7019d7d551a6402fC5350c73")

	factory, err := NewPancakeFactory(factoryAddr, c)
	allLength, err := factory.AllPairsLength(nil)
	fmt.Printf("all length:%v\n", allLength)

	for i := startIndex; i < allLength.Int64(); i++ {
		addrs := []common.Address{}
		pairAddr, _ := factory.AllPairs(nil, big.NewInt(i))
		pair, _ := NewPancakePair(pairAddr, c)

		fmt.Printf("%v, pair:%v\n", i, pairAddr)
		token0Addr, _ := pair.Token0(nil)
		token1Addr, _ := pair.Token1(nil)

		//process proxy token
		bz, err := c.StorageAt(context.Background(), token0Addr, IMPLEMENTATION_SLOT, nil)
		if err == nil {
			addr := common.BytesToAddress(bz)
			codeByte, err := c.CodeAt(context.Background(), addr, nil)
			if err == nil && len(codeByte) != 0 {
				token0Addr = addr
			}
		}

		bz, err = c.StorageAt(context.Background(), token1Addr, IMPLEMENTATION_SLOT, nil)
		if err == nil {
			addr := common.BytesToAddress(bz)
			codeByte, err := c.CodeAt(context.Background(), addr, nil)
			if err == nil && len(codeByte) != 0 {
				token1Addr = addr
			}
		}

		addrs = append(addrs, token0Addr, token1Addr)

		for _, addr := range addrs {
			if tokenMap[addr] == false {
				tokenMap[addr] = true

				db.Put(TokenStoreKey(addr.Bytes()), addr.Bytes(), nil)
				fmt.Printf("tokenCount:%v, addr:%v\n", tokenCount, addr)

				tokenCount++
				byteCode, err := c.CodeAt(context.Background(), addr, nil)
				if err != nil {
					fmt.Printf("fail to getCode:%v\n", addr)
					continue
				}
				code := hex.EncodeToString(byteCode)

				if main.isSafeMoon(code) {
					db.Put(SafeMoonStoreKey(addr.Bytes()), addr.Bytes(), nil)
					if main.isVictim(code) {
						db.Put(VictimStoreKey(addr.Bytes()), addr.Bytes(), nil)
						fmt.Printf("found: %v\n", addr)
					}
				}
			}
		}

		db.Put(LastHandledIndexStoreKey(), big.NewInt(i).Bytes(), nil)
	}
}

func TestIsSafeMoon(t *testing.T) {
	code := "60806040526004361061037a5760003560e01c806360d0eb73116101d1578063ad68ebf711610102578063d66329b0116100a0578063f2d58c231161006f578063f2d58c23146109d7578063f2fde38b146109f7578063f3290d7514610a17578063fe575a8714610a3757610381565b8063d66329b01461094f578063dd62ed3e1461096f578063dfd66cb31461098f578063ea2f0b37146109b757610381565b8063c49b9a80116100dc578063c49b9a80146108cf578063c4d66de8146108ef578063d40cf6591461090f578063d543dbeb1461092f57610381565b8063ad68ebf71461087a578063bd3900c01461089a578063bf266469146108af57610381565b80638af319c71161016f5780638fc3d4b8116101495780638fc3d4b81461080557806395d89b4114610825578063a457c2d71461083a578063a9059cbb1461085a57610381565b80638af319c7146107bb5780638da5cb5b146107db5780638dd95002146107f057610381565b8063715018a6116101ab578063715018a6146107515780637d1db4a5146107665780637ed948f71461077b57806388f820201461079b57610381565b806360d0eb73146106fc5780636bd89cdd1461071157806370a082311461073157610381565b8063313ce567116102ab5780634549b039116102495780634a74bb02116102235780634a74bb02146106875780634ffc14251461069c57806352390c02146106bc5780635342acb4146106dc57610381565b80634549b039146106325780634732a7dc1461065257806349bd5a5e1461067257610381565b806339aa1bba1161028557806339aa1bba146105b25780633af32abf146105d257806340b28c2f146105f2578063437823ec1461061257610381565b8063313ce567146105505780633685d41914610572578063395093511461059257610381565b80631694505e1161031857806323b872dd116102f257806323b872dd146104d05780632d838119146104f0578063301273341461051057806330b263ba1461053057610381565b80631694505e1461047957806318160ddd1461049b578063200c7295146104b057610381565b806311b326011161035457806311b326011461040057806313114a9d14610422578063132af75c14610437578063140c57591461044c57610381565b806306fdde0314610386578063095ea7b3146103b157806310844953146103de57610381565b3661038157005b600080fd5b34801561039257600080fd5b5061039b610a57565b6040516103a891906145f1565b60405180910390f35b3480156103bd57600080fd5b506103d16103cc3660046143e8565b610aed565b6040516103a891906145e6565b3480156103ea57600080fd5b506103fe6103f9366004614338565b610b0b565b005b34801561040c57600080fd5b50610415610bc8565b6040516103a89190614cbf565b34801561042e57600080fd5b50610415610bce565b34801561044357600080fd5b506103fe610bd4565b34801561045857600080fd5b5061046c61046736600461442f565b610c28565b6040516103a89190614c67565b34801561048557600080fd5b5061048e610cd5565b6040516103a8919061457d565b3480156104a757600080fd5b50610415610ce4565b3480156104bc57600080fd5b506103fe6104cb3660046143e8565b610cea565b3480156104dc57600080fd5b506103d16104eb3660046143a8565b610de8565b3480156104fc57600080fd5b5061041561050b36600461442f565b610e70565b34801561051c57600080fd5b5061046c61052b366004614338565b610eb3565b34801561053c57600080fd5b506103fe61054b36600461448f565b610f57565b34801561055c57600080fd5b5061056561107e565b6040516103a89190614d8a565b34801561057e57600080fd5b506103fe61058d366004614338565b611087565b34801561059e57600080fd5b506103d16105ad3660046143e8565b6111fa565b3480156105be57600080fd5b506103fe6105cd36600461448f565b611248565b3480156105de57600080fd5b506103d16105ed366004614338565b611368565b3480156105fe57600080fd5b506103fe61060d366004614370565b611385565b34801561061e57600080fd5b506103fe61062d366004614338565b61148b565b34801561063e57600080fd5b5061041561064d36600461446b565b6114ee565b34801561065e57600080fd5b506103fe61066d366004614338565b6114fc565b34801561067e57600080fd5b5061048e61155d565b34801561069357600080fd5b506103d161156c565b3480156106a857600080fd5b506103fe6106b7366004614515565b61157c565b3480156106c857600080fd5b506103fe6106d7366004614338565b6115d4565b3480156106e857600080fd5b506103d16106f7366004614338565b61170c565b34801561070857600080fd5b506103d161172a565b34801561071d57600080fd5b506103fe61072c366004614338565b61173b565b34801561073d57600080fd5b5061041561074c366004614338565b6117a1565b34801561075d57600080fd5b506103fe611803565b34801561077257600080fd5b5061041561188c565b34801561078757600080fd5b506103fe610796366004614447565b611892565b3480156107a757600080fd5b506103d16107b6366004614338565b611990565b3480156107c757600080fd5b506103fe6107d6366004614447565b6119ae565b3480156107e757600080fd5b5061048e611aad565b3480156107fc57600080fd5b5061048e611abc565b34801561081157600080fd5b506103fe61082036600461448f565b611acb565b34801561083157600080fd5b5061039b611bee565b34801561084657600080fd5b506103d16108553660046143e8565b611c4f565b34801561086657600080fd5b506103d16108753660046143e8565b611cb7565b34801561088657600080fd5b506103fe6108953660046143e8565b611ccb565b3480156108a657600080fd5b5061048e611d8e565b3480156108bb57600080fd5b506104156108ca3660046144b0565b611d9d565b3480156108db57600080fd5b506103fe6108ea366004614413565b611e01565b3480156108fb57600080fd5b506103fe61090a366004614338565b611e92565b34801561091b57600080fd5b506103fe61092a366004614338565b611f2e565b34801561093b57600080fd5b506103fe61094a36600461442f565b611f8e565b34801561095b57600080fd5b506103fe61096a36600461448f565b611ff4565b34801561097b57600080fd5b5061041561098a366004614370565b612117565b34801561099b57600080fd5b506109a4612142565b6040516103a89796959493929190614d4e565b3480156109c357600080fd5b506103fe6109d2366004614338565b612167565b3480156109e357600080fd5b506103fe6109f236600461448f565b6121c7565b348015610a0357600080fd5b506103fe610a12366004614338565b6122e8565b348015610a2357600080fd5b506103fe610a32366004614338565b6123a9565b348015610a4357600080fd5b506103d1610a52366004614338565b612417565b60718054604080516020601f6002600019610100600188161502019095169490940493840181900481028201810190925282815260609390929091830182828015610ae35780601f10610ab857610100808354040283529160200191610ae3565b820191906000526020600020905b815481529060010190602001808311610ac657829003601f168201915b5050505050905090565b6000610b01610afa612435565b8484612439565b5060015b92915050565b610b13612435565b6001600160a01b0316610b24611aad565b6001600160a01b031614610b535760405162461bcd60e51b8152600401610b4a90614a1b565b60405180910390fd5b6001600160a01b038116610b795760405162461bcd60e51b8152600401610b4a90614a50565b6001600160a01b0381166000908152606b6020526040902054610bae5760405162461bcd60e51b8152600401610b4a90614b9a565b6001600160a01b03166000908152606b6020526040812055565b60895490565b606f5490565b610bdc612435565b6001600160a01b0316610bed611aad565b6001600160a01b031614610c135760405162461bcd60e51b8152600401610b4a90614a1b565b608f805460ff60a81b1916600160a81b179055565b610c306141d4565b60895482908110610c535760405162461bcd60e51b8152600401610b4a9061496c565b60898381548110610c6057fe5b60009182526020918290206040805160e081018252600790930290910180548352600181015493830193909352600283015490820152600382015460608201526004820154608082015260058201546001600160a01b0390811660a083015260069092015490911660c0820152915050919050565b608a546001600160a01b031681565b606d5490565b610cf2612435565b6001600160a01b0316610d03611aad565b6001600160a01b031614610d295760405162461bcd60e51b8152600401610b4a90614a1b565b60895481908110610d4c5760405162461bcd60e51b8152600401610b4a9061496c565b826040518060600160405280602a8152602001614ee8602a91396001600160a01b0382166000908152606a6020526040902054819060ff1615610da25760405162461bcd60e51b8152600401610b4a91906145f1565b506001600160a01b038516610dc95760405162461bcd60e51b8152600401610b4a90614a50565b5050506001600160a01b039091166000908152606b6020526040902055565b6000610df584848461259f565b610e6584610e01612435565b610e6085604051806060016040528060288152602001614e09602891396001600160a01b038a16600090815260676020526040812090610e3f612435565b6001600160a01b0316815260208101919091526040016000205491906129b4565b612439565b5060015b9392505050565b6000606e54821115610e945760405162461bcd60e51b8152600401610b4a906146cd565b6000610e9e6129e0565b9050610eaa8382612a03565b9150505b919050565b610ebb6141d4565b6001600160a01b0382166000908152606b6020526040902054608980549091908110610ee357fe5b60009182526020918290206040805160e081018252600790930290910180548352600181015493830193909352600283015490820152600382015460608201526004820154608082015260058201546001600160a01b0390811660a083015260069092015490911660c08201529050919050565b610f5f612435565b6001600160a01b0316610f70611aad565b6001600160a01b031614610f965760405162461bcd60e51b8152600401610b4a90614a1b565b60895482908110610fb95760405162461bcd60e51b8152600401610b4a9061496c565b610fc16141d4565b60898481548110610fce57fe5b60009182526020918290206040805160e0810182526007909302909101805483526001810154938301939093526002830154908201819052600383015460608301526004830154608083015260058301546001600160a01b0390811660a084015260069093015490921660c0820152915061104b90829085612a35565b826089858154811061105957fe5b6000918252602090912060026007909202010155836110785760768390555b50505050565b60735460ff1690565b61108f612435565b6001600160a01b03166110a0611aad565b6001600160a01b0316146110c65760405162461bcd60e51b8152600401610b4a90614a1b565b6001600160a01b03811660009081526069602052604090205460ff166110fe5760405162461bcd60e51b8152600401610b4a90614802565b60005b606c548110156111f657816001600160a01b0316606c828154811061112257fe5b6000918252602090912001546001600160a01b031614156111ee57606c8054600019810190811061114f57fe5b600091825260209091200154606c80546001600160a01b03909216918390811061117557fe5b600091825260208083209190910180546001600160a01b0319166001600160a01b039485161790559184168152606682526040808220829055606990925220805460ff19169055606c8054806111c757fe5b600082815260209020810160001990810180546001600160a01b03191690550190556111f6565b600101611101565b5050565b6000610b01611207612435565b84610e608560676000611218612435565b6001600160a01b03908116825260208083019390935260409182016000908120918c168152925290205490612aa2565b611250612435565b6001600160a01b0316611261611aad565b6001600160a01b0316146112875760405162461bcd60e51b8152600401610b4a90614a1b565b608954829081106112aa5760405162461bcd60e51b8152600401610b4a9061496c565b6112b26141d4565b608984815481106112bf57fe5b60009182526020918290206040805160e08101825260079093029091018054808452600182015494840194909452600281015491830191909152600381015460608301526004810154608083015260058101546001600160a01b0390811660a08401526006909101541660c0820152915061133c90829085612a35565b826089858154811061134a57fe5b60009182526020909120600790910201558361107857505060745550565b6001600160a01b03166000908152606b6020526040902054151590565b61138d612435565b6001600160a01b031661139e611aad565b6001600160a01b0316146113c45760405162461bcd60e51b8152600401610b4a90614a1b565b608a80546001600160a01b038085166001600160a01b03199283161792839055608b8054858316931692909217909155604080516315ab88c960e31b81529051929091169163ad5c464891600480820192602092909190829003018186803b15801561142f57600080fd5b505afa158015611443573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906114679190614354565b608c80546001600160a01b0319166001600160a01b03929092169190911790555050565b611493612435565b6001600160a01b03166114a4611aad565b6001600160a01b0316146114ca5760405162461bcd60e51b8152600401610b4a90614a1b565b6001600160a01b03166000908152606860205260409020805460ff19166001179055565b6000610e6983600084611d9d565b611504612435565b6001600160a01b0316611515611aad565b6001600160a01b03161461153b5760405162461bcd60e51b8152600401610b4a90614a1b565b608d80546001600160a01b0319166001600160a01b0392909216919091179055565b608b546001600160a01b031681565b608f54600160a81b900460ff1681565b611584612435565b6001600160a01b0316611595611aad565b6001600160a01b0316146115bb5760405162461bcd60e51b8152600401610b4a90614a1b565b6115ca87878787878787612ac7565b5050505050505050565b6115dc612435565b6001600160a01b03166115ed611aad565b6001600160a01b0316146116135760405162461bcd60e51b8152600401610b4a90614a1b565b6001600160a01b03811660009081526069602052604090205460ff161561164c5760405162461bcd60e51b8152600401610b4a90614794565b6001600160a01b038116600090815260656020526040902054156116a6576001600160a01b03811660009081526065602052604090205461168c90610e70565b6001600160a01b0382166000908152606660205260409020555b6001600160a01b03166000818152606960205260408120805460ff19166001908117909155606c805491820181559091527f2b4a51ab505fc96a0952efda2ba61bcd3078d4c02c39a186ec16f21883fbe0160180546001600160a01b0319169091179055565b6001600160a01b031660009081526068602052604090205460ff1690565b608d546001600160a01b0316151590565b611743612435565b6001600160a01b0316611754611aad565b6001600160a01b03161461177a5760405162461bcd60e51b8152600401610b4a90614a1b565b608f80546001600160a01b0319166001600160a01b03831617905561179e816115d4565b50565b6001600160a01b03811660009081526069602052604081205460ff16156117e157506001600160a01b038116600090815260666020526040902054610eae565b6001600160a01b038216600090815260656020526040902054610b0590610e70565b61180b612435565b6001600160a01b031661181c611aad565b6001600160a01b0316146118425760405162461bcd60e51b8152600401610b4a90614a1b565b6033546040516000916001600160a01b0316907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0908390a3603380546001600160a01b0319169055565b60905481565b61189a612435565b6001600160a01b03166118ab611aad565b6001600160a01b0316146118d15760405162461bcd60e51b8152600401610b4a90614a1b565b608954829081106118f45760405162461bcd60e51b8152600401610b4a9061496c565b6001600160a01b03821661191a5760405162461bcd60e51b8152600401610b4a90614b12565b611923826115d4565b816089848154811061193157fe5b906000526020600020906007020160050160006101000a8154816001600160a01b0302191690836001600160a01b03160217905550826000141561198b57607980546001600160a01b0319166001600160a01b0384161790555b505050565b6001600160a01b031660009081526069602052604090205460ff1690565b6119b6612435565b6001600160a01b03166119c7611aad565b6001600160a01b0316146119ed5760405162461bcd60e51b8152600401610b4a90614a1b565b60895482908110611a105760405162461bcd60e51b8152600401610b4a9061496c565b6001600160a01b038216611a365760405162461bcd60e51b8152600401610b4a90614b12565b611a3f826115d4565b8160898481548110611a4d57fe5b906000526020600020906007020160060160006101000a8154816001600160a01b0302191690836001600160a01b03160217905550826000141561198b57607a80546001600160a01b0384166001600160a01b0319909116179055505050565b6033546001600160a01b031690565b608c546001600160a01b031681565b611ad3612435565b6001600160a01b0316611ae4611aad565b6001600160a01b031614611b0a5760405162461bcd60e51b8152600401610b4a90614a1b565b60895482908110611b2d5760405162461bcd60e51b8152600401610b4a9061496c565b611b356141d4565b60898481548110611b4257fe5b60009182526020918290206040805160e0810182526007909302909101805483526001810154938301939093526002830154908201526003820154606082015260048201546080820181905260058301546001600160a01b0390811660a084015260069093015490921660c08201529150611bbf90829085612a35565b8260898581548110611bcd57fe5b60009182526020909120600460079092020101558361107857505060785550565b60728054604080516020601f6002600019610100600188161502019095169490940493840181900481028201810190925282815260609390929091830182828015610ae35780601f10610ab857610100808354040283529160200191610ae3565b6000610b01611c5c612435565b84610e6085604051806060016040528060258152602001614e9a6025913960676000611c86612435565b6001600160a01b03908116825260208083019390935260409182016000908120918d168152925290205491906129b4565b6000610b01611cc4612435565b848461259f565b81604051806060016040528060298152602001614ebf602991396001600160a01b0382166000908152606a6020526040902054819060ff1615611d215760405162461bcd60e51b8152600401610b4a91906145f1565b50608d546001600160a01b0316611d4a5760405162461bcd60e51b8152600401610b4a90614ad0565b608d546001600160a01b0316611d5e612435565b6001600160a01b031614611d845760405162461bcd60e51b8152600401610b4a9061493d565b6110788484612ca1565b608f546001600160a01b031681565b6000606d54841115611dc15760405162461bcd60e51b8152600401610b4a90614870565b81611de257611dce614223565b611dd88585612ce1565b519150610e699050565b611dea614223565b611df48585612ce1565b602001519150610e699050565b611e09612435565b6001600160a01b0316611e1a611aad565b6001600160a01b031614611e405760405162461bcd60e51b8152600401610b4a90614a1b565b608f805460ff60a81b1916600160a81b831515021790556040517f53726dfcaf90650aa7eb35524f4d3220f07413c8d6cb404cc8c18bf5591bc15990611e879083906145e6565b60405180910390a150565b600054610100900460ff1680611eab5750611eab612db3565b80611eb9575060005460ff16155b611ed55760405162461bcd60e51b8152600401610b4a906148ef565b600054610100900460ff16158015611f00576000805460ff1961ff0019909116610100171660011790555b611f08612dc4565b611f10612e46565b611f1982612f20565b80156111f6576000805461ff00191690555050565b611f36612435565b6001600160a01b0316611f47611aad565b6001600160a01b031614611f6d5760405162461bcd60e51b8152600401610b4a90614a1b565b6001600160a01b03166000908152606a60205260409020805460ff19169055565b611f96612435565b6001600160a01b0316611fa7611aad565b6001600160a01b031614611fcd5760405162461bcd60e51b8152600401610b4a90614a1b565b611fee612710611fe883606d546132f390919063ffffffff16565b90612a03565b60905550565b611ffc612435565b6001600160a01b031661200d611aad565b6001600160a01b0316146120335760405162461bcd60e51b8152600401610b4a90614a1b565b608954829081106120565760405162461bcd60e51b8152600401610b4a9061496c565b61205e6141d4565b6089848154811061206b57fe5b60009182526020918290206040805160e0810182526007909302909101805483526001810154938301939093526002830154908201526003820154606082018190526004830154608083015260058301546001600160a01b0390811660a084015260069093015490921660c082015291506120e890829085612a35565b82608985815481106120f657fe5b60009182526020909120600360079092020101558361107857505060775550565b6001600160a01b03918216600090815260676020908152604080832093909416825291909152205490565b607454607554607654607754607854607954607a546001600160a01b03918216911687565b61216f612435565b6001600160a01b0316612180611aad565b6001600160a01b0316146121a65760405162461bcd60e51b8152600401610b4a90614a1b565b6001600160a01b03166000908152606860205260409020805460ff19169055565b6121cf612435565b6001600160a01b03166121e0611aad565b6001600160a01b0316146122065760405162461bcd60e51b8152600401610b4a90614a1b565b608954829081106122295760405162461bcd60e51b8152600401610b4a9061496c565b6122316141d4565b6089848154811061223e57fe5b60009182526020918290206040805160e0810182526007909302909101805483526001810154938301849052600281015491830191909152600381015460608301526004810154608083015260058101546001600160a01b0390811660a08401526006909101541660c082015291506122b990829085612a35565b82608985815481106122c757fe5b60009182526020909120600160079092020101558361107857505060755550565b6122f0612435565b6001600160a01b0316612301611aad565b6001600160a01b0316146123275760405162461bcd60e51b8152600401610b4a90614a1b565b6001600160a01b03811661234d5760405162461bcd60e51b8152600401610b4a90614717565b6033546040516001600160a01b038084169216907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a3603380546001600160a01b0319166001600160a01b0392909216919091179055565b6123b1612435565b6001600160a01b03166123c2611aad565b6001600160a01b0316146123e85760405162461bcd60e51b8152600401610b4a90614a1b565b6001600160a01b03166000908152606a60209081526040808320805460ff19166001179055606b909152812055565b6001600160a01b03166000908152606a602052604090205460ff1690565b3390565b82604051806060016040528060268152602001614e54602691396001600160a01b0382166000908152606a6020526040902054819060ff161561248f5760405162461bcd60e51b8152600401610b4a91906145f1565b5083604051806060016040528060288152602001614de1602891396001600160a01b0382166000908152606a6020526040902054819060ff16156124e65760405162461bcd60e51b8152600401610b4a91906145f1565b506001600160a01b03871661250d5760405162461bcd60e51b8152600401610b4a90614689565b6001600160a01b0386166125335760405162461bcd60e51b8152600401610b4a90614c25565b6001600160a01b038088166000818152606760209081526040808320948b168084529490915290819020889055517f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259061258e908990614cbf565b60405180910390a350505050505050565b6125a7612435565b60408051808201825260208082527f536166656d6f6f6e3a204164647265737320697320626c61636b6c6973746564818301526001600160a01b0384166000908152606a9091529190912054819060ff16156126165760405162461bcd60e51b8152600401610b4a91906145f1565b5084604051806060016040528060258152602001614dbc602591396001600160a01b0382166000908152606a6020526040902054819060ff161561266d5760405162461bcd60e51b8152600401610b4a91906145f1565b5085604051806060016040528060238152602001614e31602391396001600160a01b0382166000908152606a6020526040902054819060ff16156126c45760405162461bcd60e51b8152600401610b4a91906145f1565b506126cd612435565b803b63ffffffff811615612792576001600160a01b0382166000908152606b602052604090205480612790576000839050806001600160a01b031663c45a01556040518163ffffffff1660e01b815260040160206040518083038186803b15801561273757600080fd5b505afa925050508015612767575060408051601f3d908101601f1916820190925261276491810190614354565b60015b6127705761278e565b506001600160a01b0384166000908152606b60205260409020600190555b505b505b506001600160a01b038a166127b95760405162461bcd60e51b8152600401610b4a90614644565b6001600160a01b0389166127df5760405162461bcd60e51b8152600401610b4a90614b57565b600088116127ff5760405162461bcd60e51b8152600401610b4a90614a87565b612807611aad565b6001600160a01b03168a6001600160a01b031614158015612841575061282b611aad565b6001600160a01b0316896001600160a01b031614155b15612868576090548811156128685760405162461bcd60e51b8152600401610b4a906148a7565b6000612873306117a1565b9050609054811061288357506090545b609154811080159081906128a15750608f54600160a01b900460ff16155b80156128bb5750608b546001600160a01b038d8116911614155b80156128d05750608f54600160a81b900460ff165b156128e35760915491506128e38261332d565b6001600160a01b038c1660009081526068602052604090205460019060ff168061292557506001600160a01b038c1660009081526068602052604090205460ff165b1561292e575060005b6000811561299757506001600160a01b038d166000818152606b602052604090205490612959612435565b6001600160a01b03161461299757606b6000612973612435565b6001600160a01b03166001600160a01b031681526020019081526020016000205490505b6129a48e8e8e84866133ce565b5050505050505050505050505050565b600081848411156129d85760405162461bcd60e51b8152600401610b4a91906145f1565b505050900390565b60008060006129ed613548565b90925090506129fc8282612a03565b9250505090565b6000808211612a245760405162461bcd60e51b8152600401610b4a90614839565b818381612a2d57fe5b049392505050565b6000612a7e82612a7285612a788860800151612a728a60600151612a728c60400151612a728e602001518f60000151612aa290919063ffffffff16565b90612aa2565b906136ab565b90506070548111156110785760405162461bcd60e51b8152600401610b4a90614bdf565b600082820183811015610e695760405162461bcd60e51b8152600401610b4a9061475d565b612acf6141d4565b612ad76141d4565b612b246040518060e001604052808b81526020018a8152602001898152602001888152602001878152602001866001600160a01b03168152602001856001600160a01b03168152506136d3565b9050612b2f846115d4565b612b38836115d4565b6089805460018101825560009190915281517f5bfa74c743914028161ae645d300d90bbdc659f169ca1469ec86b4960f7266cb60079092029182015560208201517f5bfa74c743914028161ae645d300d90bbdc659f169ca1469ec86b4960f7266cc82015560408201517f5bfa74c743914028161ae645d300d90bbdc659f169ca1469ec86b4960f7266cd82015560608201517f5bfa74c743914028161ae645d300d90bbdc659f169ca1469ec86b4960f7266ce82015560808201517f5bfa74c743914028161ae645d300d90bbdc659f169ca1469ec86b4960f7266cf82015560a08201517f5bfa74c743914028161ae645d300d90bbdc659f169ca1469ec86b4960f7266d0820180546001600160a01b03199081166001600160a01b039384161790915560c08401517f5bfa74c743914028161ae645d300d90bbdc659f169ca1469ec86b4960f7266d190930180549091169290911691909117905598975050505050505050565b6001600160a01b038216612cc75760405162461bcd60e51b8152600401610b4a906149e4565b608e546111f6906001600160a01b031683836000806133ce565b612ce9614223565b612cf161426f565b612cfb848461373b565b90506000612d2a8260a00151612a728460800151612a7286602001518760400151612aa290919063ffffffff16565b90506000806000612d4888866060015186612d436129e0565b613881565b92509250925060405180610120016040528084815260200183815260200182815260200186600001518152602001866020015181526020018660400151815260200186606001518152602001866080015181526020018660a001518152509550505050505092915050565b6000612dbe306138d1565b15905090565b600054610100900460ff1680612ddd5750612ddd612db3565b80612deb575060005460ff16155b612e075760405162461bcd60e51b8152600401610b4a906148ef565b600054610100900460ff16158015612e32576000805460ff1961ff0019909116610100171660011790555b801561179e576000805461ff001916905550565b600054610100900460ff1680612e5f5750612e5f612db3565b80612e6d575060005460ff16155b612e895760405162461bcd60e51b8152600401610b4a906148ef565b600054610100900460ff16158015612eb4576000805460ff1961ff0019909116610100171660011790555b6000612ebe612435565b603380546001600160a01b0319166001600160a01b038316908117909155604051919250906000907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0908290a350801561179e576000805461ff001916905550565b600054610100900460ff1680612f395750612f39612db3565b80612f47575060005460ff16155b612f635760405162461bcd60e51b8152600401610b4a906148ef565b600054610100900460ff16158015612f8e576000805460ff1961ff0019909116610100171660011790555b6040805180820190915260088082526729b0b332a6b7b7b760c11b6020909201918252612fbd916071916142a5565b506040805180820190915260038082526253464d60e81b6020909201918252612fe8916072916142a5565b506073805460ff19166009179055683635c9adc5dea00000606d8190556000190619606e556103e8607055608f8054674563918244f400006090556706f05b59d3b200006091556001600160a01b031960ff60a81b19909116600160a81b171661dead179055613056612435565b608e80546001600160a01b03199081166001600160a01b039384161791829055606e5491831660009081526065602090815260409182902093909355608a8054909216868516179182905580516315ab88c960e31b81529051919093169263ad5c4648926004808301939192829003018186803b1580156130d657600080fd5b505afa1580156130ea573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061310e9190614354565b608c80546001600160a01b0319166001600160a01b03928316179055608a546040805163c45a015560e01b81529051919092169163c45a0155916004808301926020929190829003018186803b15801561316757600080fd5b505afa15801561317b573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061319f9190614354565b608c546040516364e329cb60e11b81526001600160a01b039283169263c9c65396926131d392309290911690600401614591565b602060405180830381600087803b1580156131ed57600080fd5b505af1158015613201573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906132259190614354565b608b80546001600160a01b0319166001600160a01b0392909216919091179055600160686000613253611aad565b6001600160a01b0316815260208082019290925260409081016000908120805494151560ff19958616179055308152606890925290208054909116600117905561329b6138d7565b6132a3612435565b6001600160a01b031660006001600160a01b0316600080516020614e7a833981519152606d546040516132d69190614cbf565b60405180910390a380156111f6576000805461ff00191690555050565b60008261330257506000610b05565b8282028284828161330f57fe5b0414610e695760405162461bcd60e51b8152600401610b4a906149a3565b608f805460ff60a01b1916600160a01b179055600061334d826002612a03565b9050600061335b83836136ab565b90504761336783613a04565b600061337347836136ab565b905061337f8382613b60565b7f17bbfb9a6069321b6ded73bd96327c9e6b7212a5cd51ff219cd61370acafb5618482856040516133b293929190614d38565b60405180910390a15050608f805460ff60a01b19169055505050565b806133db576133db613c0b565b6001600160a01b03851660009081526069602052604090205460ff16801561341c57506001600160a01b03841660009081526069602052604090205460ff16155b156134325761342d85858585613d0d565b613534565b6001600160a01b03851660009081526069602052604090205460ff1615801561347357506001600160a01b03841660009081526069602052604090205460ff165b156134845761342d85858585613e28565b6001600160a01b03851660009081526069602052604090205460ff161580156134c657506001600160a01b03841660009081526069602052604090205460ff16155b156134d75761342d85858585613ed3565b6001600160a01b03851660009081526069602052604090205460ff16801561351757506001600160a01b03841660009081526069602052604090205460ff165b156135285761342d85858585613f0d565b61353485858585613ed3565b8061354157613541613f78565b5050505050565b606e54606d546000918291825b606c54811015613679578260656000606c848154811061357157fe5b60009182526020808320909101546001600160a01b0316835282019290925260400190205411806135d657508160666000606c84815481106135af57fe5b60009182526020808320909101546001600160a01b03168352820192909252604001902054115b156135ed57606e54606d54945094505050506136a7565b61362d60656000606c848154811061360157fe5b60009182526020808320909101546001600160a01b0316835282019290925260400190205484906136ab565b925061366f60666000606c848154811061364357fe5b60009182526020808320909101546001600160a01b0316835282019290925260400190205483906136ab565b9150600101613555565b50606d54606e5461368991612a03565b8210156136a157606e54606d549350935050506136a7565b90925090505b9091565b6000828211156136cd5760405162461bcd60e51b8152600401610b4a906147cb565b50900390565b6136db6141d4565b60006137108360800151612a728560600151612a728760400151612a7289602001518a60000151612aa290919063ffffffff16565b90506070548111156137345760405162461bcd60e51b8152600401610b4a90614bdf565b5090919050565b61374361426f565b61374b6141d4565b6089838154811061375857fe5b60009182526020918290206040805160e081018252600790930290910180548352600181015493830193909352600283015490820152600382015460608201526004820154608082015260058201546001600160a01b0390811660a083015260069092015490911660c082015290506137cf61426f565b6040518060c00160405280600081526020016137ef878560000151613f88565b8152602001613802878560200151613f88565b8152602001613815878560400151613f88565b8152602001613828878560600151613f88565b815260200161383b878560800151613f88565b81525090506138778160a00151612a788360800151612a788560400151612a788760600151612a7889602001518e6136ab90919063ffffffff16565b8152949350505050565b600080808061389088866132f3565b9050600061389e88876132f3565b905060006138ac88886132f3565b905060006138be82612a7886866136ab565b939b939a50919850919650505050505050565b3b151590565b600054610100900460ff16806138f057506138f0612db3565b806138fe575060005460ff16155b61391a5760405162461bcd60e51b8152600401610b4a906148ef565b600054610100900460ff16158015613945576000805460ff1961ff0019909116610100171660011790555b61395960006101f480600080600080612ac7565b8051607455602081015160755560408101516076556060810151607755608081015160785560a0810151607980546001600160a01b03199081166001600160a01b039384161790915560c090920151607a805490931691161790556139c660328060646000808080612ac7565b506139da6032806064806000806000612ac7565b506139ef6064607d8060966000806000612ac7565b50801561179e576000805461ff001916905550565b60408051600280825260608083018452926020830190803683370190505090503081600081518110613a3257fe5b6001600160a01b03928316602091820292909201810191909152608a54604080516315ab88c960e31b81529051919093169263ad5c4648926004808301939192829003018186803b158015613a8657600080fd5b505afa158015613a9a573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190613abe9190614354565b81600181518110613acb57fe5b6001600160a01b039283166020918202929092010152608a54613af19130911684612439565b608a5460405163791ac94760e01b81526001600160a01b039091169063791ac94790613b2a908590600090869030904290600401614cc8565b600060405180830381600087803b158015613b4457600080fd5b505af1158015613b58573d6000803e3d6000fd5b505050505050565b608a54613b789030906001600160a01b031684612439565b608a546001600160a01b031663f305d719823085600080613b97611aad565b426040518863ffffffff1660e01b8152600401613bb9969594939291906145ab565b6060604051808303818588803b158015613bd257600080fd5b505af1158015613be6573d6000803e3d6000fd5b50505050506040513d601f19601f8201168201806040525081019061354191906144e8565b6089600081548110613c1957fe5b6000918252602082206007909102018054607b556001810154607c556002810154607d556003810154607e556004810154607f556005810154608080546001600160a01b03199081166001600160a01b03938416179091556006909201546081805490931691161790556089805460829290613c9157fe5b6000918252602090912082546007909202019081556001808301549082015560028083015490820155600380830154908201556004808301549082015560058083015490820180546001600160a01b03199081166001600160a01b03938416179091556006938401549390920180549092169216919091179055565b613d15614223565b613d1f8383612ce1565b6001600160a01b038616600090815260666020526040902054909150613d4590846136ab565b6001600160a01b0386166000908152606660209081526040808320939093558351606590915291902054613d78916136ab565b6001600160a01b0380871660009081526065602090815260408083209490945584015191871681529190912054613dae91612aa2565b6001600160a01b038516600090815260656020526040902055613dd2858284613fa7565b613de481604001518260c00151614035565b836001600160a01b0316856001600160a01b0316600080516020614e7a8339815191528360600151604051613e199190614cbf565b60405180910390a35050505050565b613e30614223565b613e3a8383612ce1565b80516001600160a01b038716600090815260656020526040902054919250613e6291906136ab565b6001600160a01b0380871660009081526065602090815260408083209490945560608501519288168252606690529190912054613e9e91612aa2565b6001600160a01b03851660009081526066602090815260408083209390935583810151606590915291902054613dae91612aa2565b613edb614223565b613ee58383612ce1565b80516001600160a01b038716600090815260656020526040902054919250613d7891906136ab565b613f15614223565b613f1f8383612ce1565b6001600160a01b038616600090815260666020526040902054909150613f4590846136ab565b6001600160a01b0386166000908152606660209081526040808320939093558351606590915291902054613e62916136ab565b607b6089600081548110613c9157fe5b600081613f9757506000610b05565b610e69612710611fe885856132f3565b613fb6838360a0015130614059565b613fee83836080015160898481548110613fcc57fe5b60009182526020909120600560079092020101546001600160a01b0316614059565b614026838360e001516089848154811061400457fe5b60009182526020909120600660079092020101546001600160a01b0316614059565b61198b8383610100015161414f565b606e5461404290836136ab565b606e55606f546140529082612aa2565b606f555050565b6001600160a01b03811661406c5761198b565b816140765761198b565b60006140806129e0565b9050600061408e84836132f3565b6001600160a01b0384166000908152606560205260409020549091506140b49082612aa2565b6001600160a01b03841660009081526065602090815260408083209390935560699052205460ff161561411e576001600160a01b0383166000908152606660205260409020546141049085612aa2565b6001600160a01b0384166000908152606660205260409020555b826001600160a01b0316856001600160a01b0316600080516020614e7a83398151915286604051613e199190614cbf565b80614159576111f6565b608f546001600160a01b031660009081526066602052604090205461417e9082612aa2565b608f80546001600160a01b039081166000908152606660205260409081902093909355905491519181169190841690600080516020614e7a833981519152906141c8908590614cbf565b60405180910390a35050565b6040518060e00160405280600081526020016000815260200160008152602001600081526020016000815260200160006001600160a01b0316815260200160006001600160a01b031681525090565b6040518061012001604052806000815260200160008152602001600081526020016000815260200160008152602001600081526020016000815260200160008152602001600081525090565b6040518060c001604052806000815260200160008152602001600081526020016000815260200160008152602001600081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106142e657805160ff1916838001178555614313565b82800160010185558215614313579182015b828111156143135782518255916020019190600101906142f8565b5061431f929150614323565b5090565b5b8082111561431f5760008155600101614324565b600060208284031215614349578081fd5b8135610e6981614d98565b600060208284031215614365578081fd5b8151610e6981614d98565b60008060408385031215614382578081fd5b823561438d81614d98565b9150602083013561439d81614d98565b809150509250929050565b6000806000606084860312156143bc578081fd5b83356143c781614d98565b925060208401356143d781614d98565b929592945050506040919091013590565b600080604083850312156143fa578182fd5b823561440581614d98565b946020939093013593505050565b600060208284031215614424578081fd5b8135610e6981614dad565b600060208284031215614440578081fd5b5035919050565b60008060408385031215614459578182fd5b82359150602083013561439d81614d98565b6000806040838503121561447d578182fd5b82359150602083013561439d81614dad565b600080604083850312156144a1578182fd5b50508035926020909101359150565b6000806000606084860312156144c4578283fd5b833592506020840135915060408401356144dd81614dad565b809150509250925092565b6000806000606084860312156144fc578283fd5b8351925060208401519150604084015190509250925092565b600080600080600080600060e0888a03121561452f578283fd5b873596506020880135955060408801359450606088013593506080880135925060a088013561455d81614d98565b915060c088013561456d81614d98565b8091505092959891949750929550565b6001600160a01b0391909116815260200190565b6001600160a01b0392831681529116602082015260400190565b6001600160a01b039687168152602081019590955260408501939093526060840191909152909216608082015260a081019190915260c00190565b901515815260200190565b6000602080835283518082850152825b8181101561461d57858101830151858201604001528201614601565b8181111561462e5783604083870101525b50601f01601f1916929092016040019392505050565b60208082526025908201527f42455032303a207472616e736665722066726f6d20746865207a65726f206164604082015264647265737360d81b606082015260800190565b60208082526024908201527f42455032303a20617070726f76652066726f6d20746865207a65726f206164646040820152637265737360e01b606082015260800190565b6020808252602a908201527f416d6f756e74206d757374206265206c657373207468616e20746f74616c207260408201526965666c656374696f6e7360b01b606082015260800190565b60208082526026908201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160408201526564647265737360d01b606082015260800190565b6020808252601b908201527f536166654d6174683a206164646974696f6e206f766572666c6f770000000000604082015260600190565b6020808252601b908201527f4163636f756e7420697320616c7265616479206578636c756465640000000000604082015260600190565b6020808252601e908201527f536166654d6174683a207375627472616374696f6e206f766572666c6f770000604082015260600190565b6020808252601b908201527f4163636f756e7420697320616c726561647920696e636c756465640000000000604082015260600190565b6020808252601a908201527f536166654d6174683a206469766973696f6e206279207a65726f000000000000604082015260600190565b6020808252601f908201527f416d6f756e74206d757374206265206c657373207468616e20737570706c7900604082015260600190565b60208082526028908201527f5472616e7366657220616d6f756e74206578636565647320746865206d6178546040820152673c20b6b7bab73a1760c11b606082015260800190565b6020808252602e908201527f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160408201526d191e481a5b9a5d1a585b1a5e995960921b606082015260800190565b60208082526015908201527414d859995b5bdbdb8e88139bdd08105b1b1bddd959605a1b604082015260600190565b6020808252601c908201527f536166656d6f6f6e3a20496e76616c6964207469657220696e64657800000000604082015260600190565b60208082526021908201527f536166654d6174683a206d756c7469706c69636174696f6e206f766572666c6f6040820152607760f81b606082015260800190565b6020808252601f908201527f42455032303a206d696e7420746f20746865207a65726f206164647265737300604082015260600190565b6020808252818101527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572604082015260600190565b60208082526019908201527f536166656d6f6f6e3a20496e76616c6964206164647265737300000000000000604082015260600190565b60208082526029908201527f5472616e7366657220616d6f756e74206d7573742062652067726561746572206040820152687468616e207a65726f60b81b606082015260800190565b60208082526022908201527f536166656d6f6f6e3a204d6967726174696f6e206973206e6f74207374617274604082015261195960f21b606082015260800190565b60208082526025908201527f536166656d6f6f6e3a2041646472657373205a65726f206973206e6f7420616c6040820152641b1bddd95960da1b606082015260800190565b60208082526023908201527f42455032303a207472616e7366657220746f20746865207a65726f206164647260408201526265737360e81b606082015260800190565b60208082526025908201527f536166656d6f6f6e3a204163636f756e74206973206e6f7420696e2077686974604082015264195b1a5cdd60da1b606082015260800190565b60208082526026908201527f536166656d6f6f6e3a2046656573206578636565646564206d6178206c696d696040820152653a30ba34b7b760d11b606082015260800190565b60208082526022908201527f42455032303a20617070726f766520746f20746865207a65726f206164647265604082015261737360f01b606082015260800190565b815181526020808301519082015260408083015190820152606080830151908201526080808301519082015260a0808301516001600160a01b039081169183019190915260c092830151169181019190915260e00190565b90815260200190565b600060a082018783526020878185015260a0604085015281875180845260c0860191508289019350845b81811015614d175784516001600160a01b031683529383019391830191600101614cf2565b50506001600160a01b03969096166060850152505050608001529392505050565b9283526020830191909152604082015260600190565b96875260208701959095526040860193909352606085019190915260808401526001600160a01b0390811660a08401521660c082015260e00190565b60ff91909116815260200190565b6001600160a01b038116811461179e57600080fd5b801515811461179e57600080fdfe536166656d6f6f6e3a2046726f6d206164647265737320697320626c61636b6c6973746564536166656d6f6f6e3a205370656e646572206164647265737320697320626c61636b6c697374656442455032303a207472616e7366657220616d6f756e74206578636565647320616c6c6f77616e6365536166656d6f6f6e3a20546f206164647265737320697320626c61636b6c6973746564536166656d6f6f6e3a204f776e6572206164647265737320697320626c61636b6c6973746564ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef42455032303a2064656372656173656420616c6c6f77616e63652062656c6f77207a65726f536166656d6f6f6e3a204d69677261746564206163636f756e7420697320626c61636b6c6973746564536166656d6f6f6e3a2053656c6563746564206163636f756e7420697320696e20626c61636b6c697374a2646970667358221220be6830526df9469573d67a2a43f3ff1d2fc85c2f5baa82c07f13bd319f94bb3364736f6c634300060c0033"
	res1 := strings.Contains(code, "4549b039")
	require.True(t, res1)

	result := main.isSafeMoon(code)
	require.True(t, result)
}

func TestIsProxy(t *testing.T) {
	rpcURL := "https://bsc-dataseed.binance.org"
	c, err := ethclient.Dial(rpcURL)
	require.NoError(t, err)
	tokenAddr := common.HexToAddress("0x42981d0bfbAf196529376EE702F2a9Eb9092fcB5")

	bz, err := c.StorageAt(context.Background(), tokenAddr, IMPLEMENTATION_SLOT, nil)
	if err == nil {
		addr := common.BytesToAddress(bz)
		codeByte, err := c.CodeAt(context.Background(), addr, nil)
		if err == nil && len(codeByte) != 0 {
			tokenAddr = addr
		}
	}
	fmt.Printf("addr:%v\n", tokenAddr)
}

func TestIsProxy1(t *testing.T) {
	rpcURL := "https://bsc-dataseed.binance.org"
	c, err := ethclient.Dial(rpcURL)
	require.NoError(t, err)
	tokenAddr := common.HexToAddress("0xE98AC4c09a3fcc35be438681652602454F6745B7")

	bz, err := c.StorageAt(context.Background(), tokenAddr, IMPLEMENTATION_SLOT, nil)
	if err == nil {
		addr := common.BytesToAddress(bz)
		codeByte, err := c.CodeAt(context.Background(), addr, nil)
		if err == nil && len(codeByte) != 0 {
			tokenAddr = addr
		}
	}
	fmt.Printf("addr:%v\n", tokenAddr)
}
